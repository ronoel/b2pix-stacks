<div class="wallet-management">
  <div class="container">
    <!-- Header -->
    <div class="page-header">
      <button class="btn-back" (click)="goBack()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
          <path d="M19 12H5M5 12L12 19M5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Voltar
      </button>
      <h1 class="page-title">Gerenciar Carteira</h1>
    </div>

    <!-- Account Verification Status -->
    <div class="verification-status-card">
      <div class="card-header">
        <h3>Verificação de Conta</h3>
        <p>Status das verificações necessárias para usar a plataforma</p>
      </div>

      @if (isLoadingAccountInfo()) {
        <div class="loading-section">
          <div class="loading-spinner"></div>
          <p>Carregando informações da conta...</p>
        </div>
      } @else {
        <div class="verification-items">
          <!-- Email Verification -->
          <div class="verification-item" [class.verified]="accountInfo()?.email_verified">
            <div class="verification-icon" [class.verified]="accountInfo()?.email_verified">
              @if (accountInfo()?.email_verified) {
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              } @else {
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <rect x="3" y="5" width="18" height="14" rx="2" stroke="currentColor" stroke-width="2"/>
                  <path d="M3 8l9 6 9-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              }
            </div>
            <div class="verification-content">
              <h4>Verificação de Email</h4>
              @if (accountInfo()?.email_verified) {
                <p class="status-verified">Email verificado com sucesso</p>
              } @else {
                <p class="status-pending">Email ainda não verificado</p>
              }
            </div>
            @if (!accountInfo()?.email_verified) {
              <button class="btn-verify" (click)="navigateToEmailVerification()">
                Verificar Email
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                  <path d="M5 12h14M12 5l7 7-7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            }
          </div>

          <!-- PIX Verification -->
          <div class="verification-item" [class.verified]="accountInfo()?.pix_verified">
            <div class="verification-icon" [class.verified]="accountInfo()?.pix_verified">
              @if (accountInfo()?.pix_verified) {
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              } @else {
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <rect x="2" y="6" width="20" height="12" rx="2" stroke="currentColor" stroke-width="2"/>
                  <circle cx="17" cy="12" r="1" fill="currentColor"/>
                </svg>
              }
            </div>
            <div class="verification-content">
              <h4>Verificação de Chave PIX</h4>
              @if (accountInfo()?.pix_verified) {
                <p class="status-verified">Chave PIX verificada com sucesso</p>
              } @else {
                <p class="status-pending">Chave PIX ainda não verificada</p>
              }
            </div>
            @if (!accountInfo()?.pix_verified) {
              <button class="btn-verify" (click)="navigateToPixVerification()">
                Verificar PIX
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                  <path d="M5 12h14M12 5l7 7-7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            }
          </div>
        </div>

        @if (accountInfo()?.email_verified && accountInfo()?.pix_verified) {
          <div class="all-verified-banner">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
              <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
              <path d="M9 12l2 2 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <div>
              <strong>Conta Totalmente Verificada!</strong>
              <p>Você pode usar todos os recursos da plataforma.</p>
            </div>
          </div>
        }
      }
    </div>

    @if (isEmbeddedWallet()) {
      <!-- Wallet Info Card -->
      <div class="info-card">
        <div class="info-header">
          <div class="info-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
              <rect x="5" y="11" width="14" height="10" rx="2" stroke="currentColor" stroke-width="2"/>
              <path d="M12 15v2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M8 11V7a4 4 0 0 1 8 0" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </div>
          <div class="info-content">
            <h2 class="info-title">Carteira Embarcada</h2>
            <p class="info-subtitle">Sob seu total controle</p>
          </div>
        </div>

        <div class="wallet-address-section">
          <label class="form-label">Endereço da Carteira</label>
          <div class="address-display">
            <code>{{ walletAddress() }}</code>
            <button class="btn-copy-small" (click)="copyAddress()" [disabled]="addressCopied()">
              @if (addressCopied()) {
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                  <path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              } @else {
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                  <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
                  <path d="M5 15H4C3.46957 15 2.96086 14.7893 2.58579 14.4142C2.21071 14.0391 2 13.5304 2 13V4C2 3.46957 2.21071 2.96086 2.58579 2.58579C2.96086 2.21071 3.46957 2 4 2H13C13.5304 2 14.0391 2.21071 14.4142 2.58579C14.7893 2.96086 15 3.46957 15 4V5" stroke="currentColor" stroke-width="2"/>
                </svg>
              }
            </button>
          </div>
        </div>
      </div>

      <!-- Security Warning -->
      <div class="warning-banner">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
          <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <div>
          <strong>Sua frase de recuperação é a chave para sua carteira</strong>
          <p>Nunca compartilhe sua frase de recuperação com ninguém. A B2Pix nunca solicitará esta informação.</p>
        </div>
      </div>

      <!-- Seed Phrase Section -->
      <div class="seed-phrase-card">
        <div class="card-header">
          <h3>Frase de Recuperação (Seed Phrase)</h3>
          <p>Use esta frase para recuperar sua carteira em caso de perda de acesso</p>
        </div>

        @if (!seedPhraseVisible()) {
          <!-- Password Form -->
          <div class="unlock-section">
            <div class="security-notice">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                <path d="M12 16V12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M12 8H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span>Para visualizar sua frase de recuperação, digite sua senha</span>
            </div>

            <div class="form-group">
              <label for="password" class="form-label">Senha da Carteira</label>
              <input
                id="password"
                type="password"
                class="form-input"
                [(ngModel)]="password"
                placeholder="Digite sua senha"
                [disabled]="isUnlocking()"
                (keyup.enter)="unlockAndViewSeed()"
              />
            </div>

            @if (errorMessage()) {
              <div class="error-message">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                  <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                  <path d="M12 8v4M12 16h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                {{ errorMessage() }}
              </div>
            }

            <button class="btn btn-primary" (click)="unlockAndViewSeed()" [disabled]="isUnlocking() || !password">
              @if (isUnlocking()) {
                <div class="loading-spinner-sm"></div>
                Desbloqueando...
              } @else {
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <path d="M2 9a3 3 0 0 1 3-3h14a3 3 0 0 1 3 3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M2 9v10a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3V9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <circle cx="12" cy="13" r="2" stroke="currentColor" stroke-width="2"/>
                </svg>
                Ver Frase de Recuperação
              }
            </button>
          </div>
        } @else {
          <!-- Seed Phrase Display -->
          <div class="seed-phrase-display">
            <div class="critical-warning">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M12 9v4M12 17h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <div>
                <strong>ATENÇÃO: Mantenha esta informação em segurança!</strong>
                <ul>
                  <li>Anote estas palavras em ordem e guarde em um local seguro</li>
                  <li>Nunca tire uma foto ou armazene digitalmente</li>
                  <li>Qualquer pessoa com acesso a esta frase pode controlar seus fundos</li>
                  <li>A B2Pix nunca solicitará sua frase de recuperação</li>
                </ul>
              </div>
            </div>

            <div class="seed-words-grid">
              @for (word of seedWords(); track $index) {
                <div class="seed-word-item">
                  <span class="word-number">{{ $index + 1 }}</span>
                  <span class="word-text">{{ word }}</span>
                </div>
              }
            </div>

            <div class="seed-actions">
              <button class="btn btn-outline" (click)="copySeedPhrase()" [disabled]="seedCopied()">
                @if (seedCopied()) {
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  Copiado!
                } @else {
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
                    <path d="M5 15H4C3.46957 15 2.96086 14.7893 2.58579 14.4142C2.21071 14.0391 2 13.5304 2 13V4C2 3.46957 2.21071 2.96086 2.58579 2.58579C2.96086 2.21071 3.46957 2 4 2H13C13.5304 2 14.0391 2.21071 14.4142 2.58579C14.7893 2.96086 15 3.46957 15 4V5" stroke="currentColor" stroke-width="2"/>
                  </svg>
                  Copiar Frase de Recuperação
                }
              </button>
              <button class="btn btn-secondary" (click)="hideSeedPhrase()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <line x1="1" y1="1" x2="23" y2="23" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Ocultar
              </button>
            </div>
          </div>
        }
      </div>

      <!-- Additional Security Tips -->
      <div class="security-tips">
        <h3>Dicas de Segurança</h3>
        <ul>
          <li>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Anote sua frase de recuperação em papel e guarde em local seguro
          </li>
          <li>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Nunca compartilhe sua senha ou frase de recuperação com ninguém
          </li>
          <li>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Faça backup da sua frase de recuperação em múltiplos locais seguros
          </li>
          <li>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Evite armazenar digitalmente ou tirar fotos da sua frase de recuperação
          </li>
        </ul>
      </div>

      <!-- Danger Zone -->
      <div class="danger-zone">
        <div class="danger-header">
          <h3>Zona de Perigo</h3>
          <p>Ações irreversíveis que afetam permanentemente sua carteira</p>
        </div>
        <div class="danger-action">
          <div class="danger-info">
            <h4>Remover Carteira</h4>
            <p>Remove permanentemente esta carteira do navegador. Certifique-se de ter feito backup da sua frase de recuperação.</p>
          </div>
          <button class="btn-danger" (click)="showDeleteConfirmation.set(true)">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M10 11v6M14 11v6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Remover Carteira
          </button>
        </div>
      </div>
    } @else {
      <!-- External Wallet Info -->
      <div class="external-wallet-info">
        <div class="info-icon-large">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none">
            <rect x="2" y="6" width="20" height="12" rx="2" stroke="currentColor" stroke-width="2"/>
            <path d="M6 6V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v2" stroke="currentColor" stroke-width="2"/>
            <circle cx="17" cy="12" r="1" fill="currentColor"/>
          </svg>
        </div>
        <h3>Carteira Externa</h3>
        <p>Você está usando uma carteira externa (Leather, Xverse, etc.). Para gerenciar sua frase de recuperação e configurações, acesse diretamente sua extensão de carteira.</p>
        <div class="wallet-address-section">
          <label class="form-label">Endereço da Carteira</label>
          <div class="address-display">
            <code>{{ walletAddress() }}</code>
            <button class="btn-copy-small" (click)="copyAddress()" [disabled]="addressCopied()">
              @if (addressCopied()) {
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                  <path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              } @else {
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                  <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
                  <path d="M5 15H4C3.46957 15 2.96086 14.7893 2.58579 14.4142C2.21071 14.0391 2 13.5304 2 13V4C2 3.46957 2.21071 2.96086 2.58579 2.58579C2.96086 2.21071 3.46957 2 4 2H13C13.5304 2 14.0391 2.21071 14.4142 2.58579C14.7893 2.96086 15 3.46957 15 4V5" stroke="currentColor" stroke-width="2"/>
                </svg>
              }
            </button>
          </div>
        </div>
      </div>
    }

    <!-- Delete Confirmation Modal -->
    @if (showDeleteConfirmation()) {
      <div class="modal-overlay" (click)="showDeleteConfirmation.set(false)">
        <div class="modal-dialog" (click)="$event.stopPropagation()">
          <div class="modal-icon-danger">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none">
              <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M12 9v4M12 17h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>

          <h3 class="modal-title">Remover Carteira Permanentemente?</h3>

          <div class="modal-warning">
            <p><strong>ATENÇÃO: Esta ação não pode ser desfeita!</strong></p>
            <p>Ao remover esta carteira:</p>
            <ul>
              <li>Todos os dados da carteira serão removidos deste navegador</li>
              <li>Você perderá o acesso aos seus fundos se não tiver o backup da frase de recuperação</li>
              <li>A única forma de recuperar o acesso é através da sua frase de recuperação de 24 palavras</li>
            </ul>
          </div>

          <div class="backup-reminder">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
              <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
              <path d="M12 16V12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M12 8H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <div>
              <strong>Você fez backup da sua frase de recuperação?</strong>
              <p>Sem ela, você não poderá acessar seus fundos novamente!</p>
            </div>
          </div>

          <div class="modal-actions">
            <button class="btn btn-secondary" (click)="showDeleteConfirmation.set(false)">
              Cancelar
            </button>
            <button class="btn-danger-confirm" (click)="confirmDeleteWallet()">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M10 11v6M14 11v6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
              Sim, Remover Minha Carteira
            </button>
          </div>
        </div>
      </div>
    }
  </div>
</div>
