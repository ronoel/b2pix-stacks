<div class="pix-payment-page">
  <div class="container">
    <!-- Header -->
    <div class="page-header">
      <button class="btn btn-ghost" (click)="goBack()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
          <path d="M19 12H5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Voltar
      </button>
      <div class="header-content">
        <h1 class="page-title">Pagar PIX</h1>
        <p class="page-subtitle">Pague um QR Code PIX com Bitcoin</p>
      </div>
    </div>

    <!-- Scanner View -->
    @if (currentView() === 'scanner') {
      <div class="view-container">
        <div class="limit-badge">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
            <path d="M12 16V12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M12 8H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          Limite por operação: R$ 1.000,00
        </div>

        <app-qr-scanner (qrCodeScanned)="onQrCodeScanned($event)" />

        <app-pix-payment-history (viewOrder)="onViewOrder($event)" />
      </div>
    }

    <!-- Confirmation View -->
    @if (currentView() === 'confirmation' && qrData()) {
      <div class="view-container">
        <app-payment-confirmation
          [qrData]="qrData()!"
          [amountInSats]="amountInSats()"
          [fee]="fee()"
          [balance]="sBtcBalance()"
          [isProcessing]="isProcessing()"
          (confirmed)="onPaymentConfirmed()"
          (cancelled)="onConfirmationCancelled()"
        />
      </div>
    }

    <!-- Processing View -->
    @if (currentView() === 'processing') {
      <div class="view-container">
        <div class="processing-state">
          <div class="processing-spinner"></div>
          <h2>Processando pagamento...</h2>
          <p>Criando e enviando transacao. Nao feche esta pagina.</p>
        </div>
      </div>
    }

    <!-- Status View -->
    @if (currentView() === 'status' && createdOrderId()) {
      <div class="view-container">
        <app-order-status
          [orderId]="createdOrderId()!"
          sourceType="pix_order"
          detailsTitle="Detalhes do Pagamento"
        />

        <div class="status-actions">
          <button class="btn btn-outline" (click)="goToDashboard()">
            Voltar ao Dashboard
          </button>
        </div>
      </div>
    }
  </div>

  <!-- Error Modal -->
  @if (showErrorModal()) {
    <div class="modal-overlay" (click)="closeErrorModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>Erro</h2>
          <button class="modal-close" (click)="closeErrorModal()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
              <path d="M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <div class="error-banner">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
              <line x1="15" y1="9" x2="9" y2="15" stroke="currentColor" stroke-width="2"/>
              <line x1="9" y1="9" x2="15" y2="15" stroke="currentColor" stroke-width="2"/>
            </svg>
            <p>{{ errorMessage() }}</p>
          </div>
          <div class="modal-actions">
            <button class="btn btn-primary" (click)="closeErrorModal()">Entendi</button>
          </div>
        </div>
      </div>
    </div>
  }
</div>
